<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Store</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<!-- ‚ïê‚ïê EMAILJS ‚ïê‚ïê -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
  emailjs.init("pE3NAPEpcB-49A8Wq");
</script>

<!-- ‚ïê‚ïê FIREBASE ‚ïê‚ïê -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc, collection, getDocs, addDoc, updateDoc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  // ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
  // ‚ïë  PASTE YOUR FIREBASE CONFIG HERE (see setup guide)  ‚ïë
  // ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
  const firebaseConfig = {
    apiKey: "AIzaSyC_xMsz7_hBPONAbQqBUfjKhcWpIEMXAEg",
    authDomain: "spectra-f4db7.firebaseapp.com",
    projectId: "spectra-f4db7",
    storageBucket: "spectra-f4db7.firebasestorage.app",
    messagingSenderId: "483276597235",
    appId: "1:483276597235:web:73cfbd46bb2320c0559486",
    measurementId: "G-FX53PD2RVX"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // ‚îÄ‚îÄ Expose db helpers to global scope ‚îÄ‚îÄ
  window._db = db;
  window._fs = { doc, getDoc, setDoc, collection, getDocs, addDoc, updateDoc, deleteDoc, onSnapshot };

  // ‚îÄ‚îÄ Load store on ready ‚îÄ‚îÄ
  window.addEventListener('load', () => {
    if (firebaseConfig.projectId === "YOUR_PROJECT_ID") {
      showSetupBanner();
    } else {
      loadStoreFromDB();
    }
  });
</script>

<style>
  :root {
    --accent: #c8a96e;
    --dark: #111;
    --bg: #f0ebe0;
    --card: #fff;
    --text: #222;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; }

  /* ‚îÄ‚îÄ SETUP BANNER ‚îÄ‚îÄ */
  #setupBanner {
    display: none;
    background: #1a1a2e;
    color: #eee;
    padding: 20px 40px;
    font-size: 0.9rem;
    border-bottom: 3px solid var(--accent);
    line-height: 1.8;
  }
  #setupBanner h3 { color: var(--accent); font-size: 1.1rem; margin-bottom: 8px; }
  #setupBanner code {
    background: #0d0d1a;
    color: #7dd3fc;
    padding: 2px 7px;
    border-radius: 4px;
    font-size: 0.85rem;
  }
  #setupBanner ol { margin: 10px 0 0 20px; }
  #setupBanner li { margin-bottom: 6px; }
  #setupBanner a { color: var(--accent); }

  /* ‚îÄ‚îÄ LOADING OVERLAY ‚îÄ‚îÄ */
  #loadingOverlay {
    position: fixed; inset: 0;
    background: var(--dark);
    z-index: 9999;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    gap: 16px;
    transition: opacity 0.5s;
  }
  #loadingOverlay .spinner {
    width: 44px; height: 44px;
    border: 3px solid #333;
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }
  #loadingOverlay p { color: #888; font-size: 0.9rem; }

  /* ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ */
  .modal-overlay {
    display: none; position: fixed; inset: 0;
    background: rgba(0,0,0,0.55);
    z-index: 1000; align-items: center; justify-content: center;
    backdrop-filter: blur(4px);
  }
  .modal-overlay.active { display: flex; }

  .modal {
    background: #fff; border-radius: 18px; padding: 36px;
    width: 90%; max-width: 440px; position: relative;
    animation: popIn 0.25s ease;
    max-height: 90vh; overflow-y: auto;
  }
  @keyframes popIn {
    from { opacity:0; transform:scale(0.92) translateY(20px); }
    to   { opacity:1; transform:scale(1) translateY(0); }
  }
  .modal h2 { font-family:'Playfair Display',serif; font-size:1.5rem; margin-bottom:6px; }
  .modal p.sub { color:#888; font-size:0.85rem; margin-bottom:22px; }

  .modal input, .modal textarea, .modal select {
    width:100%; padding:11px 13px;
    border:1.5px solid #ddd; border-radius:9px;
    font-family:'DM Sans',sans-serif; font-size:0.9rem;
    outline:none; transition:border 0.2s; margin-bottom:12px;
    background:#fafafa;
  }
  .modal input:focus, .modal textarea:focus { border-color:var(--accent); }
  .modal textarea { resize:vertical; min-height:70px; }

  .modal-btn {
    width:100%; padding:13px; border:none; border-radius:9px;
    font-family:'DM Sans',sans-serif; font-size:0.95rem; font-weight:600;
    cursor:pointer; transition:all 0.2s; margin-top:4px;
  }
  .modal-btn-primary { background:var(--dark); color:#fff; }
  .modal-btn-primary:hover { background:#333; }
  .modal-close-btn {
    position:absolute; top:16px; right:18px;
    background:none; border:none; font-size:1.5rem; cursor:pointer; color:#aaa;
  }
  .modal-close-btn:hover { color:#333; }

  .modal-error { color:#e44; font-size:0.82rem; margin:-8px 0 8px; display:none; }

  .field-row { display:flex; gap:12px; }
  .field-row > * { flex:1; }

  .img-upload-area {
    border:2px dashed #ddd; border-radius:10px;
    padding:20px; text-align:center; cursor:pointer;
    transition:border 0.2s, background 0.2s; background:#fafafa;
    display:block; margin-bottom:12px;
  }
  .img-upload-area:hover { border-color:var(--accent); background:#fffdf7; }
  .img-upload-area .u-icon { font-size:2rem; display:block; margin-bottom:6px; }
  .img-upload-area p { font-size:0.82rem; color:#aaa; }
  .img-upload-preview { display:none; margin-bottom:12px; text-align:center; }
  .img-upload-preview img { max-height:100px; border-radius:8px; border:1px solid #ddd; }
  .img-upload-preview button { display:block; margin:6px auto 0; background:none; border:none; color:#e44; cursor:pointer; font-size:0.78rem; }

  /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
  .store-header {
    background:var(--dark); color:white;
    padding:0 48px; display:flex; align-items:center; gap:14px;
    position:sticky; top:0; z-index:200;
    border-bottom:2px solid var(--accent); height:68px;
  }
  .store-logo { display:flex; align-items:center; justify-content:center; height:44px; min-width:44px; }
  .store-name { font-family:'Playfair Display',serif; font-size:1.7rem; font-weight:900; color:var(--accent); }
  .header-right { margin-left:auto; display:flex; align-items:center; gap:12px; }

  .cart-btn {
    position:relative; background:none; border:1.5px solid #444;
    color:#eee; border-radius:8px; padding:8px 14px; cursor:pointer;
    font-family:'DM Sans',sans-serif; font-size:0.85rem;
    display:flex; align-items:center; gap:6px; transition:all 0.2s;
  }
  .cart-btn:hover { border-color:var(--accent); color:var(--accent); }

  .cart-badge {
    position:absolute; top:-7px; right:-7px;
    background:var(--accent); color:#111; border-radius:50%;
    width:18px; height:18px; font-size:0.7rem; font-weight:700;
    display:none; align-items:center; justify-content:center;
  }

  .admin-btn {
    background:none; border:1.5px solid #333; color:#888;
    border-radius:8px; padding:8px 14px; cursor:pointer;
    font-family:'DM Sans',sans-serif; font-size:0.82rem; transition:all 0.2s;
  }
  .admin-btn:hover { border-color:var(--accent); color:var(--accent); }
  .admin-btn.on { border-color:var(--accent); color:var(--accent); background:rgba(200,169,110,0.08); }

  /* ‚îÄ‚îÄ ADMIN TOOLBAR ‚îÄ‚îÄ */
  .admin-bar {
    display:none; background:#141414; border-bottom:2px solid var(--accent);
    padding:12px 40px; gap:14px; align-items:center; flex-wrap:wrap;
  }
  .admin-bar.show { display:flex; }

  .bar-label { font-size:0.68rem; text-transform:uppercase; letter-spacing:0.1em; color:var(--accent); font-weight:600; }
  .bar-sep { width:1px; height:30px; background:#2a2a2a; flex-shrink:0; }

  .bar-input {
    background:#1e1e1e; border:1px solid #333; color:#eee;
    padding:8px 11px; border-radius:7px;
    font-family:'DM Sans',sans-serif; font-size:0.85rem; outline:none; transition:border 0.2s;
  }
  .bar-input:focus { border-color:var(--accent); }

  .bar-upload {
    display:flex; align-items:center; gap:7px;
    background:#1e1e1e; border:1px dashed #444; border-radius:7px;
    padding:8px 11px; cursor:pointer; color:#888; font-size:0.82rem; transition:all 0.2s;
  }
  .bar-upload:hover { border-color:var(--accent); color:var(--accent); }

  .bar-logo-thumb {
    height:34px; width:34px; border-radius:5px; object-fit:contain;
    border:1px solid #333; display:none;
  }

  .bb {
    padding:8px 15px; border-radius:7px; border:none;
    font-family:'DM Sans',sans-serif; font-size:0.82rem; font-weight:600;
    cursor:pointer; transition:all 0.2s; white-space:nowrap;
  }
  .bb-gold { background:var(--accent); color:#111; }
  .bb-gold:hover { background:#dbbf7e; }
  .bb-red { background:#e33; color:#fff; }
  .bb-red:hover { background:#c22; }
  .bb-outline { background:transparent; border:1px solid #444; color:#ccc; }
  .bb-outline:hover { border-color:var(--accent); color:var(--accent); }

  /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
  .store-hero {
    background:linear-gradient(135deg,#1a1a1a 0%,#2d2510 60%,#1a1410 100%);
    padding:90px 48px; text-align:center; position:relative; overflow:hidden;
  }
  .store-hero::before {
    content:''; position:absolute; top:-80px; left:-80px;
    width:360px; height:360px;
    background:radial-gradient(circle,rgba(200,169,110,0.12),transparent 70%);
    border-radius:50%;
  }
  .hero-logo { display:flex; align-items:center; justify-content:center; height:90px; margin:0 auto 16px; position:relative; z-index:1; }
  .hero-name { font-family:'Playfair Display',serif; font-size:3.8rem; font-weight:900; color:var(--accent); position:relative; z-index:1; }
  .hero-sub { margin-top:12px; color:#aaa; font-size:1.05rem; position:relative; z-index:1; }

  /* ‚îÄ‚îÄ PRODUCTS ‚îÄ‚îÄ */
  .products-section { padding:48px; }
  .products-header { font-family:'Playfair Display',serif; font-size:1.8rem; font-weight:700; margin-bottom:6px; }
  .products-sub { color:#888; font-size:0.9rem; margin-bottom:24px; }

  .search-row { display:flex; gap:12px; margin-bottom:28px; max-width:420px; }
  .search-row input {
    flex:1; padding:10px 14px; border:1.5px solid #ddd; border-radius:9px;
    font-family:'DM Sans',sans-serif; font-size:0.9rem; outline:none; background:white; transition:border 0.2s;
  }
  .search-row input:focus { border-color:var(--accent); }

  .products-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(230px,1fr)); gap:24px; }

  .product-card {
    background:var(--card); border-radius:16px; overflow:hidden;
    box-shadow:0 4px 20px rgba(0,0,0,0.07);
    transition:transform 0.25s,box-shadow 0.25s;
    animation:fadeIn 0.4s ease; position:relative;
  }
  @keyframes fadeIn { from{opacity:0;transform:translateY(16px)} to{opacity:1;transform:translateY(0)} }
  .product-card:hover { transform:translateY(-6px); box-shadow:0 14px 40px rgba(0,0,0,0.13); }

  .prod-img-wrap {
    height:190px; display:flex; align-items:center; justify-content:center;
    background:linear-gradient(135deg,#f5f0e8,#e8e0d0); overflow:hidden; position:relative;
  }
  .prod-img-wrap img { width:100%; height:100%; object-fit:cover; }
  .prod-img-wrap .no-img { font-size:3.5rem; opacity:0.3; }

  .admin-card-btns { position:absolute; top:8px; right:8px; display:none; gap:6px; }
  .admin-mode .admin-card-btns { display:flex; }
  .card-btn {
    background:rgba(0,0,0,0.72); border:none; color:#fff;
    border-radius:6px; padding:5px 9px; cursor:pointer; font-size:0.75rem; transition:background 0.2s;
  }
  .card-btn:hover { background:rgba(0,0,0,0.9); }
  .card-btn.del { color:#f99; }
  .card-btn.del:hover { background:#d22; color:#fff; }

  .prod-info { padding:16px; }
  .prod-name { font-weight:600; font-size:0.95rem; margin-bottom:4px; }
  .prod-desc { font-size:0.8rem; color:#888; margin-bottom:10px; line-height:1.4; }
  .prod-price { font-family:'Playfair Display',serif; font-size:1.3rem; font-weight:700; color:var(--accent); margin-bottom:12px; }
  .prod-footer { display:flex; gap:8px; }

  .atc-btn {
    flex:1; padding:9px; background:var(--dark); color:#fff; border:none;
    border-radius:8px; font-family:'DM Sans',sans-serif; font-size:0.82rem;
    font-weight:600; letter-spacing:0.04em; text-transform:uppercase; cursor:pointer; transition:background 0.2s;
  }
  .atc-btn:hover { background:var(--accent); color:#111; }
  .atc-btn.in-cart { background:var(--accent); color:#111; }

  .wish-btn { padding:9px 12px; background:none; border:1.5px solid #eee; border-radius:8px; cursor:pointer; font-size:1rem; transition:all 0.2s; }
  .wish-btn:hover { border-color:#e55; background:#fff0f0; }
  .wish-btn.on { border-color:#e55; }

  .empty-state { text-align:center; padding:70px 20px; color:#aaa; grid-column:1/-1; }
  .empty-state .ei { font-size:3.5rem; margin-bottom:14px; }

  /* ‚îÄ‚îÄ CART PANEL ‚îÄ‚îÄ */
  .cart-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); z-index:500; }
  .cart-overlay.open { display:block; }
  .cart-panel {
    position:fixed; top:0; right:-420px; width:400px; height:100vh;
    background:#fff; z-index:600; display:flex; flex-direction:column;
    transition:right 0.35s cubic-bezier(0.4,0,0.2,1);
    box-shadow:-8px 0 40px rgba(0,0,0,0.15);
  }
  .cart-panel.open { right:0; }

  .cart-head { padding:24px; border-bottom:1px solid #eee; display:flex; align-items:center; justify-content:space-between; }
  .cart-head h3 { font-family:'Playfair Display',serif; font-size:1.4rem; font-weight:700; }
  .cart-x { background:none; border:none; font-size:1.5rem; cursor:pointer; color:#aaa; }
  .cart-x:hover { color:#333; }

  .cart-body { flex:1; overflow-y:auto; padding:16px 24px; display:flex; flex-direction:column; gap:14px; }

  .cart-item { display:flex; gap:12px; align-items:center; padding:12px; background:#fafafa; border-radius:10px; border:1px solid #f0f0f0; }
  .ci-img { width:64px; height:64px; border-radius:8px; overflow:hidden; background:#f0ebe0; flex-shrink:0; display:flex; align-items:center; justify-content:center; font-size:1.8rem; }
  .ci-img img { width:100%; height:100%; object-fit:cover; }
  .ci-info { flex:1; }
  .ci-name { font-weight:600; font-size:0.9rem; margin-bottom:4px; }
  .ci-price { font-size:0.85rem; color:var(--accent); font-weight:600; }
  .ci-qty { display:flex; align-items:center; gap:8px; margin-top:6px; }
  .qty-btn { background:#eee; border:none; border-radius:5px; width:24px; height:24px; cursor:pointer; font-size:1rem; display:flex; align-items:center; justify-content:center; transition:background 0.15s; }
  .qty-btn:hover { background:#ddd; }
  .ci-rm { background:none; border:none; color:#ccc; cursor:pointer; font-size:1.2rem; }
  .ci-rm:hover { color:#e44; }

  .cart-foot { padding:20px 24px; border-top:1px solid #eee; }
  .cart-total { display:flex; justify-content:space-between; align-items:center; margin-bottom:16px; font-size:1rem; font-weight:600; }
  .cart-total-amt { font-family:'Playfair Display',serif; font-size:1.4rem; font-weight:700; color:var(--accent); }
  .checkout-btn { width:100%; padding:14px; background:var(--dark); color:#fff; border:none; border-radius:10px; font-family:'DM Sans',sans-serif; font-size:0.95rem; font-weight:700; cursor:pointer; transition:background 0.2s; }
  .checkout-btn:hover { background:var(--accent); color:#111; }
  .cart-empty-msg { text-align:center; padding:50px 0; color:#aaa; }
  .cart-empty-msg .ce { font-size:2.5rem; display:block; margin-bottom:10px; }

  /* ‚îÄ‚îÄ SAVING INDICATOR ‚îÄ‚îÄ */
  #savingIndicator {
    position:fixed; bottom:20px; left:50%; transform:translateX(-50%);
    background:var(--dark); color:#fff; padding:10px 22px;
    border-radius:30px; font-size:0.82rem; z-index:9000;
    border:1px solid #333; display:none; align-items:center; gap:8px;
  }
  #savingIndicator.show { display:flex; }
  #savingIndicator .dot { width:8px; height:8px; background:var(--accent); border-radius:50%; animation:pulse 1s infinite; }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }

  /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
  .toast { position:fixed; bottom:30px; right:30px; background:var(--dark); color:#fff; padding:12px 20px; border-radius:10px; font-size:0.88rem; font-weight:500; z-index:9999; transform:translateY(80px); opacity:0; transition:all 0.3s; border-left:3px solid var(--accent); max-width:300px; }
  .toast.show { transform:translateY(0); opacity:1; }

  footer { background:var(--dark); color:#555; text-align:center; padding:24px; font-size:0.82rem; border-top:1px solid #222; }
</style>
</head>
<body>

<!-- LOADING -->
<div id="loadingOverlay">
  <div class="spinner"></div>
  <p>Loading store...</p>
</div>

<!-- SETUP BANNER -->
<div id="setupBanner">
  <h3>‚öôÔ∏è Firebase Setup Required</h3>
  <p>To make your store permanent for all visitors, connect it to Firebase (free). Follow these steps:</p>
  <ol>
    <li>Go to <a href="https://console.firebase.google.com" target="_blank">console.firebase.google.com</a> and create a new project.</li>
    <li>Click <strong>Firestore Database</strong> ‚Üí Create database ‚Üí Start in <strong>test mode</strong>.</li>
    <li>Go to <strong>Project Settings</strong> ‚Üí <strong>Your apps</strong> ‚Üí Add a <strong>Web app</strong>.</li>
    <li>Copy the <code>firebaseConfig</code> object and paste it into this HTML file where it says <code>YOUR_API_KEY</code> etc.</li>
    <li>In Firestore ‚Üí Rules, set: <code>allow read: if true; allow write: if true;</code> (for now).</li>
    <li>Save and reopen the file ‚Äî your store is now live and permanent! üéâ</li>
  </ol>
</div>

<!-- LOGIN MODAL -->
<div class="modal-overlay" id="loginModal">
  <div class="modal">
    <h2>üîê Admin Login</h2>
    <p class="sub">Enter your password to manage the store.</p>
    <input type="password" id="adminPw" placeholder="Admin password" onkeydown="if(event.key==='Enter')tryLogin()">
    <p class="modal-error" id="loginErr">Incorrect password. Try again.</p>
    <button class="modal-btn modal-btn-primary" onclick="tryLogin()">Login</button>
  </div>
</div>

<!-- CHANGE PASSWORD MODAL -->
<div class="modal-overlay" id="changePwModal">
  <div class="modal">
    <button class="modal-close-btn" onclick="closeModal('changePwModal')">√ó</button>
    <h2>üîë Change Password</h2>
    <p class="sub">Update your admin password.</p>
    <input type="password" id="oldPw" placeholder="Current password">
    <input type="password" id="newPw" placeholder="New password (min 4 chars)">
    <input type="password" id="confirmPw" placeholder="Confirm new password">
    <p class="modal-error" id="pwErr">Something went wrong. Check your inputs.</p>
    <button class="modal-btn modal-btn-primary" onclick="changePassword()">Update Password</button>
  </div>
</div>

<!-- ADD / EDIT PRODUCT MODAL -->
<div class="modal-overlay" id="productModal">
  <div class="modal" style="max-width:480px;">
    <button class="modal-close-btn" onclick="closeProductModal()">√ó</button>
    <h2 id="prodModalTitle">Add Product</h2>
    <p class="sub">Fill in the product details.</p>
    <input type="text" id="pName" placeholder="Product name *">
    <textarea id="pDesc" placeholder="Short description (optional)"></textarea>
    <div class="field-row">
      <input type="number" id="pPrice" placeholder="Price *" min="0" step="0.01">
      <select id="pCurrency">
        <option value="$">$ USD</option>
        <option value="‚Ç¨">‚Ç¨ EUR</option>
        <option value="¬£">¬£ GBP</option>
        <option value="‚Çπ">‚Çπ INR</option>
        <option value="¬•">¬• JPY</option>
      </select>
    </div>
    <label class="img-upload-area" for="pImg">
      <span class="u-icon">üì∑</span>
      <p>Click to upload product image</p>
    </label>
    <input type="file" accept="image/*" id="pImg" style="display:none" onchange="handleProdImg(event)">
    <div class="img-upload-preview" id="pImgPreview">
      <img id="pImgThumb" src="">
      <button onclick="clearProdImg()">‚úï Remove</button>
    </div>
    <button class="modal-btn modal-btn-primary" onclick="saveProduct()">Save Product</button>
  </div>
</div>

<!-- CHECKOUT MODAL -->
<div class="modal-overlay" id="checkoutModal">
  <div class="modal">
    <button class="modal-close-btn" onclick="closeModal('checkoutModal')">√ó</button>
    <h2>üõí Checkout</h2>
    <p class="sub">Almost there! Fill in your details.</p>
    <input type="text" id="buyerName" placeholder="Full Name *">
    <input type="email" id="buyerEmail" placeholder="Email Address *">
    <input type="text" id="buyerPhone" placeholder="Phone Number">
    <input type="text" id="buyerAddr" placeholder="Delivery Address *">
    <button class="modal-btn modal-btn-primary" onclick="placeOrder()">Place Order üéâ</button>
  </div>
</div>

<!-- SUCCESS MODAL -->
<div class="modal-overlay" id="successModal">
  <div class="modal" style="text-align:center;">
    <div style="font-size:3.5rem;margin-bottom:12px;">üéâ</div>
    <h2>Order Placed!</h2>
    <p class="sub" style="margin-bottom:24px;">Thank you! Your order has been received and we'll be in touch soon.</p>
    <button class="modal-btn modal-btn-primary" onclick="closeModal('successModal')">Continue Shopping</button>
  </div>
</div>

<!-- HEADER -->
<header class="store-header">
  <div class="store-logo" id="headerLogo"><span style="font-size:2rem;">‚ú¶</span></div>
  <span class="store-name" id="headerName">My Store</span>
  <div class="header-right">
    <button class="cart-btn" onclick="openCart()">
      üõí Cart
      <span class="cart-badge" id="cartBadge">0</span>
    </button>
    <button class="admin-btn" id="adminBtn" onclick="handleAdminToggle()">‚öô Admin</button>
  </div>
</header>

<!-- ADMIN TOOLBAR -->
<div class="admin-bar" id="adminBar">
  <span class="bar-label">Admin Panel</span>
  <div class="bar-sep"></div>

  <div style="display:flex;flex-direction:column;gap:3px;">
    <span style="font-size:0.67rem;color:#555;text-transform:uppercase;letter-spacing:0.08em;">Store Name</span>
    <input type="text" class="bar-input" id="storeNameIn" value="My Store" style="width:160px;" oninput="debounceSaveBranding()">
  </div>

  <div style="display:flex;flex-direction:column;gap:3px;">
    <span style="font-size:0.67rem;color:#555;text-transform:uppercase;letter-spacing:0.08em;">Symbol / Logo</span>
    <div style="display:flex;align-items:center;gap:8px;">
      <input type="text" class="bar-input" id="symbolIn" value="‚ú¶" maxlength="4" style="width:52px;" oninput="debounceSaveBranding()">
      <label class="bar-upload">
        üñºÔ∏è Logo
        <input type="file" accept="image/*" id="logoIn" style="display:none" onchange="handleLogoUpload(event)">
      </label>
      <img id="logoThumb" class="bar-logo-thumb" src="">
      <button id="rmLogoBtn" class="bb bb-outline" onclick="removeLogo()" style="display:none;padding:5px 9px;font-size:0.75rem;">‚úï</button>
    </div>
  </div>

  <div style="display:flex;flex-direction:column;gap:3px;">
    <span style="font-size:0.67rem;color:#555;text-transform:uppercase;letter-spacing:0.08em;">Theme Color</span>
    <input type="color" id="accentIn" value="#c8a96e" style="height:34px;width:46px;cursor:pointer;border:1px solid #444;border-radius:6px;background:none;padding:2px;" oninput="debounceSaveBranding()">
  </div>

  <div class="bar-sep"></div>
  <button class="bb bb-gold" onclick="openProductModal()">+ Add Product</button>
  <button class="bb bb-outline" onclick="openModal('changePwModal')">üîë Password</button>
  <button class="bb bb-red" onclick="adminLogout()">Logout</button>
</div>

<!-- HERO -->
<div class="store-hero">
  <div class="hero-logo" id="heroLogo"><span style="font-size:5rem;">‚ú¶</span></div>
  <div class="hero-name" id="heroName">My Store</div>
  <div class="hero-sub">Discover our curated collection of premium products</div>
</div>

<!-- PRODUCTS -->
<main class="products-section" id="mainSection">
  <div class="products-header">Our Products</div>
  <div class="products-sub">Hand-picked quality items just for you</div>
  <div class="search-row">
    <input type="text" id="searchIn" placeholder="üîç Search products..." oninput="renderProducts()">
  </div>
  <div class="products-grid" id="productsGrid"></div>
</main>

<!-- CART -->
<div class="cart-overlay" id="cartOverlay" onclick="closeCart()"></div>
<div class="cart-panel" id="cartPanel">
  <div class="cart-head">
    <h3>Your Cart</h3>
    <button class="cart-x" onclick="closeCart()">√ó</button>
  </div>
  <div class="cart-body" id="cartBody"></div>
  <div class="cart-foot" id="cartFoot" style="display:none;">
    <div class="cart-total">
      <span>Total</span>
      <span class="cart-total-amt" id="cartTotalAmt">$0.00</span>
    </div>
    <button class="checkout-btn" onclick="openCheckout()">Proceed to Checkout ‚Üí</button>
  </div>
</div>

<!-- SAVING INDICATOR -->
<div id="savingIndicator"><div class="dot"></div> Saving changes...</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<footer>
  <span id="footerName">My Store</span> &nbsp;¬∑&nbsp; Powered by ‚ù§Ô∏è &nbsp;¬∑&nbsp; All rights reserved
</footer>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let isAdmin = false;
let products = [];
let cart = [];
let wishlist = new Set();
let branding = { name:'My Store', symbol:'‚ú¶', accent:'#c8a96e', logo:null, password:'admin123' };
let editingProductId = null;
let currentProdImg = null;
let logoDataUrl = null;
let debounceTimer = null;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FIREBASE HELPERS (set by module above)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function db() { return window._db; }
function fs() { return window._fs; }

function showSetupBanner() {
  document.getElementById('setupBanner').style.display = 'block';
  document.getElementById('loadingOverlay').style.opacity = 0;
  setTimeout(() => document.getElementById('loadingOverlay').style.display = 'none', 500);
  // Run in demo mode (localStorage only)
  loadLocalFallback();
}

function loadLocalFallback() {
  const saved = JSON.parse(localStorage.getItem('store_data') || '{}');
  products = saved.products || [];
  branding = { ...branding, ...(saved.branding || {}) };
  applyBranding();
  renderProducts();
  hideLoading();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOAD FROM FIREBASE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadStoreFromDB() {
  try {
    const { doc, getDoc, collection, onSnapshot } = fs();

    // Load branding
    const brandSnap = await getDoc(doc(db(), 'store', 'branding'));
    if (brandSnap.exists()) {
      branding = { ...branding, ...brandSnap.data() };
      applyBranding();
    }

    // Live-listen to products (auto-updates for all visitors!)
    onSnapshot(collection(db(), 'products'), snap => {
      products = snap.docs.map(d => ({ id: d.id, ...d.data() }));
      renderProducts();
    });

    hideLoading();
  } catch(e) {
    console.error('Firebase error:', e);
    showToast('‚ö†Ô∏è Could not connect to database. Running in local mode.');
    loadLocalFallback();
  }
}

function hideLoading() {
  const el = document.getElementById('loadingOverlay');
  el.style.opacity = 0;
  setTimeout(() => el.style.display = 'none', 500);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BRANDING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function applyBranding() {
  const { name, symbol, accent, logo } = branding;
  // Name
  ['headerName','heroName','footerName'].forEach(id => document.getElementById(id).textContent = name);
  document.title = name;
  document.getElementById('storeNameIn').value = name;
  // Symbol / logo
  logoDataUrl = logo || null;
  document.getElementById('symbolIn').value = symbol;
  renderLogo();
  // Accent
  document.documentElement.style.setProperty('--accent', accent);
  document.getElementById('accentIn').value = accent;
  // Logo thumb in toolbar
  if (logo) {
    document.getElementById('logoThumb').src = logo;
    document.getElementById('logoThumb').style.display = 'block';
    document.getElementById('rmLogoBtn').style.display = '';
  }
  // Password
  if (branding.password) window._adminPw = branding.password;
  else window._adminPw = 'admin123';
}

function renderLogo() {
  if (logoDataUrl) {
    document.getElementById('headerLogo').innerHTML = `<img src="${logoDataUrl}" style="height:44px;width:44px;object-fit:contain;border-radius:8px;">`;
    document.getElementById('heroLogo').innerHTML   = `<img src="${logoDataUrl}" style="height:90px;width:90px;object-fit:contain;border-radius:12px;">`;
  } else {
    const sym = document.getElementById('symbolIn').value || '‚ú¶';
    document.getElementById('headerLogo').innerHTML = `<span style="font-size:2rem;">${sym}</span>`;
    document.getElementById('heroLogo').innerHTML   = `<span style="font-size:5rem;">${sym}</span>`;
  }
}

function handleLogoUpload(e) {
  const file = e.target.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    logoDataUrl = ev.target.result;
    document.getElementById('logoThumb').src = logoDataUrl;
    document.getElementById('logoThumb').style.display = 'block';
    document.getElementById('rmLogoBtn').style.display = '';
    renderLogo();
    debounceSaveBranding();
  };
  reader.readAsDataURL(file);
}

function removeLogo() {
  logoDataUrl = null;
  document.getElementById('logoIn').value = '';
  document.getElementById('logoThumb').style.display = 'none';
  document.getElementById('rmLogoBtn').style.display = 'none';
  renderLogo();
  debounceSaveBranding();
}

function debounceSaveBranding() {
  renderLogo();
  ['headerName','heroName','footerName'].forEach(id => document.getElementById(id).textContent = document.getElementById('storeNameIn').value || 'My Store');
  document.title = document.getElementById('storeNameIn').value || 'My Store';
  document.documentElement.style.setProperty('--accent', document.getElementById('accentIn').value);
  clearTimeout(debounceTimer);
  debounceTimer = setTimeout(saveBranding, 1200);
}

async function saveBranding() {
  showSaving();
  branding = {
    name: document.getElementById('storeNameIn').value || 'My Store',
    symbol: document.getElementById('symbolIn').value || '‚ú¶',
    accent: document.getElementById('accentIn').value,
    logo: logoDataUrl,
    password: branding.password
  };
  try {
    if (window._db) {
      const { doc, setDoc } = fs();
      await setDoc(doc(db(), 'store', 'branding'), branding);
    } else {
      const saved = JSON.parse(localStorage.getItem('store_data') || '{}');
      localStorage.setItem('store_data', JSON.stringify({ ...saved, branding }));
    }
  } catch(e) { console.error(e); }
  hideSaving();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN AUTH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function handleAdminToggle() {
  if (isAdmin) { adminLogout(); return; }
  openModal('loginModal');
  setTimeout(() => document.getElementById('adminPw').focus(), 100);
}

function tryLogin() {
  const pw = document.getElementById('adminPw').value;
  const correct = window._adminPw || branding.password || 'admin123';
  if (pw === correct) {
    isAdmin = true;
    document.getElementById('loginErr').style.display = 'none';
    document.getElementById('adminPw').value = '';
    closeModal('loginModal');
    document.getElementById('adminBar').classList.add('show');
    document.getElementById('adminBtn').classList.add('on');
    document.getElementById('adminBtn').textContent = '‚öô Admin ‚úì';
    document.getElementById('mainSection').classList.add('admin-mode');
    renderProducts();
    showToast('‚úÖ Welcome back, Admin!');
  } else {
    document.getElementById('loginErr').style.display = 'block';
    document.getElementById('adminPw').value = '';
    document.getElementById('adminPw').focus();
  }
}

function adminLogout() {
  isAdmin = false;
  document.getElementById('adminBar').classList.remove('show');
  document.getElementById('adminBtn').classList.remove('on');
  document.getElementById('adminBtn').textContent = '‚öô Admin';
  document.getElementById('mainSection').classList.remove('admin-mode');
  renderProducts();
  showToast('üëã Logged out.');
}

async function changePassword() {
  const oldPw = document.getElementById('oldPw').value;
  const newPw = document.getElementById('newPw').value;
  const confPw = document.getElementById('confirmPw').value;
  const err = document.getElementById('pwErr');
  const correct = window._adminPw || branding.password || 'admin123';

  if (oldPw !== correct) { err.textContent = 'Current password is wrong.'; err.style.display='block'; return; }
  if (newPw !== confPw)   { err.textContent = "New passwords don't match."; err.style.display='block'; return; }
  if (newPw.length < 4)   { err.textContent = 'Password must be at least 4 characters.'; err.style.display='block'; return; }

  branding.password = newPw;
  window._adminPw = newPw;
  await saveBranding();
  err.style.display = 'none';
  ['oldPw','newPw','confirmPw'].forEach(id => document.getElementById(id).value = '');
  closeModal('changePwModal');
  showToast('üîë Password updated!');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PRODUCTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openProductModal(id = null) {
  editingProductId = id;
  const p = id ? products.find(x => x.id === id) : null;
  document.getElementById('prodModalTitle').textContent = p ? 'Edit Product' : 'Add Product';
  document.getElementById('pName').value    = p ? p.name    : '';
  document.getElementById('pDesc').value    = p ? (p.desc||'') : '';
  document.getElementById('pPrice').value   = p ? p.price   : '';
  document.getElementById('pCurrency').value= p ? p.currency: '$';
  currentProdImg = p ? (p.image || null) : null;
  if (currentProdImg) {
    document.getElementById('pImgThumb').src = currentProdImg;
    document.getElementById('pImgPreview').style.display = 'block';
  } else {
    document.getElementById('pImgPreview').style.display = 'none';
  }
  openModal('productModal');
  setTimeout(() => document.getElementById('pName').focus(), 100);
}

function closeProductModal() {
  currentProdImg = null;
  document.getElementById('pImg').value = '';
  document.getElementById('pImgPreview').style.display = 'none';
  closeModal('productModal');
}

function handleProdImg(e) {
  const file = e.target.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    currentProdImg = ev.target.result;
    document.getElementById('pImgThumb').src = currentProdImg;
    document.getElementById('pImgPreview').style.display = 'block';
  };
  reader.readAsDataURL(file);
}

function clearProdImg() {
  currentProdImg = null;
  document.getElementById('pImg').value = '';
  document.getElementById('pImgPreview').style.display = 'none';
}

async function saveProduct() {
  const name = document.getElementById('pName').value.trim();
  const price = parseFloat(document.getElementById('pPrice').value);
  if (!name)           { showToast('‚ö†Ô∏è Please enter a product name.'); return; }
  if (isNaN(price)||price<0) { showToast('‚ö†Ô∏è Please enter a valid price.'); return; }

  showSaving();
  const data = {
    name, price,
    desc: document.getElementById('pDesc').value.trim(),
    currency: document.getElementById('pCurrency').value,
    image: currentProdImg || null,
    updatedAt: Date.now()
  };

  try {
    if (window._db) {
      const { doc, setDoc, addDoc, collection, updateDoc } = fs();
      if (editingProductId) {
        await updateDoc(doc(db(), 'products', editingProductId), data);
        showToast('‚úèÔ∏è Product updated!');
      } else {
        await addDoc(collection(db(), 'products'), data);
        showToast('‚úÖ Product added!');
      }
    } else {
      // local fallback
      if (editingProductId) {
        const idx = products.findIndex(p => p.id === editingProductId);
        products[idx] = { ...products[idx], ...data };
        showToast('‚úèÔ∏è Product updated!');
      } else {
        products.push({ id: Date.now().toString(), ...data });
        showToast('‚úÖ Product added!');
      }
      saveLocal();
      renderProducts();
    }
  } catch(e) { console.error(e); showToast('‚ùå Error saving product.'); }

  hideSaving();
  closeProductModal();
}

async function deleteProduct(id) {
  if (!confirm('Delete this product?')) return;
  showSaving();
  try {
    if (window._db) {
      const { doc, deleteDoc } = fs();
      await deleteDoc(doc(db(), 'products', id));
    } else {
      products = products.filter(p => p.id !== id);
      cart = cart.filter(c => c.id !== id);
      saveLocal();
      renderProducts();
    }
    showToast('üóëÔ∏è Product deleted.');
  } catch(e) { console.error(e); showToast('‚ùå Error deleting.'); }
  renderCart();
  hideSaving();
}

function saveLocal() {
  localStorage.setItem('store_data', JSON.stringify({ products, branding }));
}

function renderProducts() {
  const grid = document.getElementById('productsGrid');
  const q = (document.getElementById('searchIn').value || '').toLowerCase();
  const filtered = products.filter(p =>
    p.name.toLowerCase().includes(q) || (p.desc||'').toLowerCase().includes(q)
  );

  if (!filtered.length) {
    grid.innerHTML = `<div class="empty-state"><div class="ei">üì¶</div><p>${products.length ? 'No results found.' : 'No products yet. Check back soon!'}</p></div>`;
    return;
  }

  grid.innerHTML = filtered.map(p => {
    const inCart = cart.some(c => c.id === p.id);
    const wished = wishlist.has(p.id);
    return `
      <div class="product-card">
        <div class="prod-img-wrap">
          ${p.image ? `<img src="${p.image}" alt="${p.name}">` : '<div class="no-img">üì¶</div>'}
          <div class="admin-card-btns">
            <button class="card-btn" onclick="openProductModal('${p.id}')">‚úèÔ∏è Edit</button>
            <button class="card-btn del" onclick="deleteProduct('${p.id}')">üóë Del</button>
          </div>
        </div>
        <div class="prod-info">
          <div class="prod-name">${p.name}</div>
          ${p.desc ? `<div class="prod-desc">${p.desc}</div>` : ''}
          <div class="prod-price">${p.currency}${parseFloat(p.price).toFixed(2)}</div>
          <div class="prod-footer">
            <button class="atc-btn ${inCart?'in-cart':''}" onclick="addToCart('${p.id}')">
              ${inCart ? '‚úì In Cart' : 'Add to Cart'}
            </button>
            <button class="wish-btn ${wished?'on':''}" onclick="toggleWish('${p.id}')" title="Wishlist">
              ${wished ? '‚ù§Ô∏è' : 'ü§ç'}
            </button>
          </div>
        </div>
      </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CART
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function addToCart(id) {
  const p = products.find(x => x.id === id);
  const ex = cart.find(c => c.id === id);
  if (ex) ex.qty++;
  else cart.push({ ...p, qty: 1 });
  renderCart(); renderProducts(); updateBadge();
  showToast(`üõí "${p.name}" added to cart!`);
}

function updateCartQty(id, d) {
  const item = cart.find(c => c.id === id);
  if (!item) return;
  item.qty += d;
  if (item.qty <= 0) cart = cart.filter(c => c.id !== id);
  renderCart(); renderProducts(); updateBadge();
}

function removeFromCart(id) {
  cart = cart.filter(c => c.id !== id);
  renderCart(); renderProducts(); updateBadge();
}

function updateBadge() {
  const total = cart.reduce((a,c) => a+c.qty, 0);
  const el = document.getElementById('cartBadge');
  el.textContent = total;
  el.style.display = total > 0 ? 'flex' : 'none';
}

function renderCart() {
  const body = document.getElementById('cartBody');
  const foot = document.getElementById('cartFoot');

  if (!cart.length) {
    body.innerHTML = '<div class="cart-empty-msg"><span class="ce">üõí</span>Your cart is empty</div>';
    foot.style.display = 'none'; return;
  }

  body.innerHTML = cart.map(item => `
    <div class="cart-item">
      <div class="ci-img">${item.image ? `<img src="${item.image}">` : 'üì¶'}</div>
      <div class="ci-info">
        <div class="ci-name">${item.name}</div>
        <div class="ci-price">${item.currency}${(item.price * item.qty).toFixed(2)}</div>
        <div class="ci-qty">
          <button class="qty-btn" onclick="updateCartQty('${item.id}',-1)">‚àí</button>
          <span style="min-width:20px;text-align:center;font-weight:600;">${item.qty}</span>
          <button class="qty-btn" onclick="updateCartQty('${item.id}',1)">+</button>
        </div>
      </div>
      <button class="ci-rm" onclick="removeFromCart('${item.id}')">√ó</button>
    </div>`).join('');

  const total = cart.reduce((a,c) => a + c.price*c.qty, 0);
  document.getElementById('cartTotalAmt').textContent = `${cart[0]?.currency||'$'}${total.toFixed(2)}`;
  foot.style.display = 'block';
}

function openCart()  { document.getElementById('cartPanel').classList.add('open'); document.getElementById('cartOverlay').classList.add('open'); }
function closeCart() { document.getElementById('cartPanel').classList.remove('open'); document.getElementById('cartOverlay').classList.remove('open'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WISHLIST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleWish(id) {
  wishlist.has(id) ? wishlist.delete(id) : wishlist.add(id);
  renderProducts();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHECKOUT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openCheckout() { closeCart(); openModal('checkoutModal'); }

async function placeOrder() {
  const name  = document.getElementById('buyerName').value.trim();
  const email = document.getElementById('buyerEmail').value.trim();
  const addr  = document.getElementById('buyerAddr').value.trim();
  const phone = document.getElementById('buyerPhone').value.trim();
  if (!name||!email||!addr) { showToast('‚ö†Ô∏è Please fill all required fields.'); return; }

  const itemsList = cart.map(c => `${c.name} x${c.qty} = ${c.currency}${(c.price*c.qty).toFixed(2)}`).join('\n');
  const total = cart.reduce((a,c)=>a+c.price*c.qty,0);
  const currency = cart[0]?.currency || '$';

  const order = {
    buyer: { name, email, phone, address: addr },
    items: cart.map(c => ({ name:c.name, qty:c.qty, price:c.price, currency:c.currency })),
    total,
    placedAt: Date.now()
  };

  // ‚îÄ‚îÄ Save to Firebase ‚îÄ‚îÄ
  try {
    if (window._db) {
      const { collection, addDoc } = fs();
      await addDoc(collection(db(),'orders'), order);
    }
  } catch(e) { console.error(e); }

  // ‚îÄ‚îÄ Send Email Notification via EmailJS ‚îÄ‚îÄ
  try {
    await emailjs.send('service_4zkwio7', 'template_1cw499s', {
      buyer_name:    name,
      buyer_email:   email,
      buyer_phone:   phone || 'Not provided',
      buyer_address: addr,
      order_items:   itemsList,
      order_total:   currency + total.toFixed(2)
    });
    console.log('Order notification email sent!');
  } catch(e) {
    console.error('Email failed:', e);
  }

  cart = [];
  renderCart(); updateBadge(); renderProducts();
  ['buyerName','buyerEmail','buyerPhone','buyerAddr'].forEach(id => document.getElementById(id).value='');
  closeModal('checkoutModal');
  openModal('successModal');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MODALS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openModal(id) { document.getElementById(id).classList.add('active'); }
function closeModal(id) { document.getElementById(id).classList.remove('active'); }

document.querySelectorAll('.modal-overlay').forEach(o => {
  o.addEventListener('click', e => {
    if (e.target === o && o.id !== 'loginModal') closeModal(o.id);
  });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UI HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>t.classList.remove('show'), 3000);
}

function showSaving() { document.getElementById('savingIndicator').classList.add('show'); }
function hideSaving()  { document.getElementById('savingIndicator').classList.remove('show'); }
</script>
</body>
</html>
